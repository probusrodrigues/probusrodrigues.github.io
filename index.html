<html>
<head>
    <title>Online Vaccine Center-Palghar</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.css">

    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.js"></script>


    <script>
        $(function () {
            $("#tabs").tabs();
        });
        var D = formatDate(new Date());
        function formatDate(date) {
            var d = new Date(date),
                month = '' + (d.getMonth() + 1),
                day = '' + d.getDate(),
                year = d.getFullYear();

            if (month.length < 2)
                month = '0' + month;
            if (day.length < 2)
                day = '0' + day;

            return [day, month, year].join('-');
        }
    </script>
</head>
<body>
    <div id="tabs">
        <ul>
            <li><a href="#tabs-1">Online Centers</a></li>
            <li><a href="#tabs-2">All Centers</a></li>
            
        </ul>
        <div id="tabs-1">
            <div class="row">
                <div class="col-sm-12">
                    <h1> Covid 19 Vaccincation Centers for Palghar</h1>
                    <br />
                    <div class="row">
                        <div class="col-sm-2">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="" id="ShowAll">
                                <label class="form-check-label" for="ShowAll">
                                    Show All Centers
                                </label>
                            </div>
                        </div>
                        <div class="col-sm-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" checked value="" id="ShowBlock">
                                <label class="form-check-label" for="ShowBlock">
                                    Show Vasai Virar Centers 
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="div1" class="row text-center" style="padding:20px;">


            </div>
        </div>
        <div id="tabs-2">
            <div>
                <table id="CenterList" class="table table-bordered table-striped" style="width:100%">
                    <thead>
                        <tr>
                            <th>Center Name</th>
                            <th>Address</th>
                            <th>State</th>
                            <th>District</th>
                            <th>Block</th>
                            <th>PinCode</th>
                            <th>Fee</th>
                        </tr>
                    </thead>
                    <tbody>
                      
                    </tbody>
                </table>

            </div>
        </div>
      
    </div>
    <div class="container-fluid text-center">
     

    </div>
</body>
<script>
    ShowCenters();
    setInterval(function () {
        ShowCenters();
    }, 30000);
    $('#ShowAll , #ShowBlock').change(function () {
        ShowCenters();
    });
    function ShowCenters() {

        $.ajax({
            url: "https://cdn-api.co-vin.in/api/v2/appointment/sessions/calendarByDistrict?district_id=394&date=" + D, success: function (result) {
                console.log(result.centers)


                var centers = result.centers;
                $("#div1").html("");
                
                if ($('#ShowBlock').is(':checked')) {
                    centers = centers.filter(x => x.block_name == "VVCMC" || x.block_name=="Vasai");

                }
                $.each(centers, function (index, value) {
                    available_capacity = 0;
                    var sessiondetails = "";
                    $.each(value.sessions, function (index1, session) {
                        available_capacity += session.available_capacity
                        sessiondetails += "<p>Total Available Capacity:" + session.available_capacity + "</p>";
                        sessiondetails += "<p>Available Capacity Dose1:" + session.available_capacity_dose1 + "</p>";
                        sessiondetails += "<p>Available Capacity Dose2:" + session.available_capacity_dose2 + "</p>";
                        sessiondetails += "<p>Date:" + session.date + "</p>";
                        sessiondetails += "<p>Age Limit:" + session.min_age_limit + "</p>";
                        sessiondetails += "<p>Vaccine:" + session.vaccine + "</p>";
                    });
                    var txtcss = "";
                    if (available_capacity > 0)
                        txtcss = "text-white bg-success";
                    else
                        txtcss = "text-white bg-danger"
                    var html = "<div class='col-sm-4'><div class='card " + txtcss+" mb-3' style='min-width: 10rem;'> <div class='card-header'>" + value.name + "</div>";
                    html += "<div class='card-body'> <p>Center Name:" + value.name + "</p>";
                    html += "<button class='btn btn-link' style='color:white' type='button' data-toggle='collapse' data-target='#collapse" + value.center_id + "' aria-expanded='false' aria-controls='collapse" + value.center_id + "'>View Address</button >";
                    html += "<div id='collapse" + value.center_id + "' class='collapse collapsed' aria-labelledby='headingOne' data-parent='#accordionExample'> " + value.address + "  </div>";
                   //html += "<p>Address:" + value.address + "</p>";
                    html += "<p>State Name:" + value.state_name + "</p>";
                    html += "<p>District Name:" + value.district_name + "</p>";
                    html += "<p>Block Name:" + value.block_name + "</p>";
                    html += "<p>PinCode:" + value.pincode + "</p>";
                    html += "<p>Fee Type:" + value.fee_type + "</p>";
                    //  html += "<p>Sessions:" + JSON.stringify(value.sessions) + "</p>";
                    //html += "<p>Sessions:" + JSON.stringify(value.sessions) + "</p>";
                   
                   // html += "<p>Available Capacity:" + available_capacity + "</p>";
                    html += sessiondetails;
                    html += "</div></div></div>";
                    if (available_capacity > 0 || $('#ShowAll').is(':checked'))
                        $("#div1").append(html);
                    //else
                      //  $("#div1").html("No Centers Found");
                   




                });
                if ($.fn.DataTable.isDataTable('#CenterList')) {
                    $('#CenterList').DataTable().destroy();
                }
                $('#CenterList').DataTable({
                    data: result.centers,
                    columns: [
                        { data: 'name' },
                        { data: 'address' },
                        { data: 'state_name' },
                        { data: 'district_name' },
                        { data: 'block_name' },
                        { data: 'pincode' },
                        { data: 'fee_type' },
                    ]
                });

                //$('#CenterList').DataTable({
                //    ajax: "https://cdn-api.co-vin.in/api/v2/appointment/sessions/calendarByDistrict?district_id=394&date=" + D,
                //    columns: [
                //        { data: 'name' },
                //        { data: 'position' },
                //        { data: 'salary' },
                //        { data: 'state_date' },
                //        { data: 'office' },
                //        { data: 'extn' }
                //    ]
                //});
            }
        });

    }
</script>
</html>
