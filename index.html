<html>
<head>
    <title>Online Vaccine Center-Palghar</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <!--<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>-->
    <!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">-->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.css">

    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.js"></script>

    <script src="https://cdn.datatables.net/fixedheader/3.1.9/js/dataTables.fixedHeader.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.8/js/dataTables.responsive.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.8/js/responsive.bootstrap.min.js"></script>

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/fixedheader/3.1.9/css/fixedHeader.bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.2.8/css/responsive.bootstrap.min.css">


    <script>
      
        var D = formatDate(new Date());
        function formatDate(date) {
            var d = new Date(date),
                month = '' + (d.getMonth() + 1),
                day = '' + d.getDate(),
                year = d.getFullYear();

            if (month.length < 2)
                month = '0' + month;
            if (day.length < 2)
                day = '0' + day;

            return [day, month, year].join('-');
        }
    </script>
    <style type="text/css">
        .card:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(0,0,0,.12), 0 4px 8px rgba(0,0,0,.06);
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-sm-12">
                <h1> Covid 19 Vaccincation Centers for Palghar</h1>
                <br />
                <div class="row d-flex justify-content-center">
                    <div class="col-sm-4">
                        <div class="btn-group" role="group" aria-label="Basic checkbox toggle button group">
                            <input type="checkbox" class="btn-check" id="ShowAll" autocomplete="off">
                            <label class="btn btn-sm btn-outline-primary" for="ShowAll">Show All</label>

                            <input type="checkbox" class="btn-check" id="ShowBlock" autocomplete="off">
                            <label class="btn btn-sm btn-outline-primary" for="ShowBlock">VVMC</label>

                            <input type="checkbox" class="btn-check" id="Show18" autocomplete="off">
                            <label class="btn btn-sm btn-outline-primary" for="Show18">18+</label>

                            <input type="checkbox" class="btn-check" id="Showd1" autocomplete="off">
                            <label class="btn btn-sm btn-outline-primary" for="Showd1"> Dose 1</label>

                            <input type="checkbox" class="btn-check" id="Showd2" autocomplete="off">
                            <label class="btn btn-sm btn-outline-primary" for="Showd2"> Dose 2</label>

                            <input type="checkbox" class="btn-check" id="ShowdPaid" autocomplete="off">
                            <label class="btn btn-sm btn-outline-primary" for="ShowdPaid"> Paid</label>
                        </div>


                    </div>



                </div>
            </div>
        </div>
        <div class="row">
            <br />
        </div>
        <nav>
            <div class="nav nav-tabs" id="nav-tab" role="tablist">
                <button class="nav-link active" id="nav-home-tab" data-bs-toggle="tab" data-bs-target="#nav-home" type="button" role="tab" aria-controls="nav-home" aria-selected="true">Card Format</button>
                <button class="nav-link" id="nav-profile-tab" data-bs-toggle="tab" data-bs-target="#nav-profile" type="button" role="tab" aria-controls="nav-profile" aria-selected="false">List Format</button>
            </div>
        </nav>
        <div class="tab-content" id="nav-tabContent">
            <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
                <div id="div1" class="row d-flex justify-content-center" style="padding:20px;">
                </div>
            </div>
            <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">
                <table id="CenterList" class="table table-bordered table-striped nowrap" style="width:100%">
                    <thead>
                        <tr>
                            <th>Center Name</th>
                            <th>Address</th>
                            <th>State</th>
                            <th>District</th>
                            <th>Block</th>
                            <th>PinCode</th>
                            <th>Fee</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>

       

    </div>
   
</body>
<script>
    $(".linkMap").click(function () {
        var address = $(this).data("address");
        console.log(addresss)
        var url = "https://www.google.com/maps/search/?api=1&query=" + encodeURI(address)
        window.open(url, 'name');
    });
    $(document).ready(function () {
        $('#ShowAll').prop("checked", localStorage.getItem("ShowAll") == "true");
        $('#ShowBlock').prop("checked", localStorage.getItem("ShowBlock") == "true");
        $('#Show18').prop("checked", localStorage.getItem("Show18") == "true");
        $('#Showd1').prop("checked", localStorage.getItem("Showd1") == "true");
        $('#Showd2').prop("checked", localStorage.getItem("Showd2") == "true");
        $('#ShowdPaid').prop("checked", localStorage.getItem("ShowdPaid") == "true");
        
    });
    ShowCenters();
    setInterval(function () {
        ShowCenters();
    }, 120000);
    function BindTable(filtercenter) {
        $("#div1").html("");
        if ($('#ShowBlock').is(':checked')) {
            // centers = centers.filter(x => x.block_name == "VVCMC" || x.block_name=="Vasai");
            filtercenter = filtercenter.filter(function (obj) {

                return obj.block_name == "VVCMC" || obj.block_name == "Vasai";
            });
        }

        if ($('#ShowdPaid').is(':checked')) {
            filtercenter = filtercenter.filter(x => x.fee_type != "Free");
        } 
        if ($('#Show18').is(':checked')) {
            console.log("f");
            filtercenter = filtercenter.filter(function (obj) {
                return obj.sessions.filter(function (session) {
                    return session.min_age_limit == 18;
                }).length > 0;
            });

        }
        if (!$('#ShowAll').is(':checked')) {

            filtercenter = filtercenter.filter(function (obj) {
                return obj.sessions.filter(function (session) {
                    return session.available_capacity > 0;
                }).length > 0;
            });
        }
        if ($('#Showd1').is(':checked')) {
            filtercenter = filtercenter.filter(function (obj) {
                return obj.sessions.filter(function (session) {
                    return session.available_capacity_dose1 > 0;
                }).length > 0;
            });
        }
        if ($('#Showd2').is(':checked')) {
            filtercenter = filtercenter.filter(function (obj) {
                return obj.sessions.filter(function (session) {
                    return session.available_capacity_dose2 > 0;
                }).length > 0;
            });
        }


        $.each(filtercenter, function (index, value) {
            available_capacity = 0;
            var sessiondetails = "";
            $.each(value.sessions, function (index1, session) {
                available_capacity += session.available_capacity
                // sessiondetails += "<div class='small'>";


                //sessiondetails += "Date:" + session.date + "</br>";
                //sessiondetails += "Age:" + session.min_age_limit + "</br>";
                // sessiondetails += "Vaccine:" + session.vaccine + "</div>";
                sessiondetails += "<div class='row small'>";
                sessiondetails += "<div class='col-5'>" + session.date + "</div>";
                sessiondetails += "<div class='col-5'><span class='badge bg-info text-dark'>" + session.vaccine + "</span></div>";
                sessiondetails += "<div class='col-2'><span class='badge bg-dark'>" + session.min_age_limit + "+</span></div>";
                sessiondetails += "</div>"
                sessiondetails += "<div class='row small'>";
                sessiondetails += "<div class='col-4'>Dose1: " + session.available_capacity_dose1 + "</div>";
                sessiondetails += "<div class='col-4'>Dose2:" + session.available_capacity_dose2 + "</div>"
                sessiondetails += "<div class='col-4'>Total:" + session.available_capacity + "</div>";
                sessiondetails += "</div>"
                // sessiondetails += "</div>"
                sessiondetails += "<hr>"
            });
            var txtcss = "";
            var colcss = "";
            if (available_capacity > 0) {
                txtcss = "text-white bg-success";
                colcss = "sc";

            }
            else {
                txtcss = "text-white bg-danger"
                colcss = "fc";
            }
            var centerid = value.center_id;
            var html = "";
            html += "<div class='col-sm-3 " + colcss+"'>"
            html += "<div id=" + centerid +" class='card " + txtcss + " mb-3' style='min-width: 8rem;'> "
            html += "<div class='card-header '><div class='row'><div class='col-8'>" + value.name + "</div><div class='col-4 text-end'><span class='badge bg-primary'>" + value.fee_type + "</span></div></div></div>";
            html += "<div class='card-body'>";
           // html += "<h5 class='card-title'>" + value.name + "</h5>"
            html += "<p class='small'>";
            html += value.address+" , ";
            html += value.state_name + " , " ;
            html += value.district_name + " , " ;
            html += value.block_name + " , ";
            html += value.pincode ;
            html += "</p><hr>";
            html += sessiondetails;
            html += "</div>";
            html += "</div>";
           // html+="</div>";


            setTimeout(function () {
                $("#div1").append(html);               
                $('.sc').prependTo('#div1');
                $("#" + centerid).effect("shake");
            }, 500 * index );

        });
        
         

        if ($.fn.DataTable.isDataTable('#CenterList')) {
            $('#CenterList').DataTable().destroy();
        }
        $('#CenterList').DataTable({
            data: filtercenter,
            responsive: true,
            columns: [
                { data: 'name' },
                { data: 'address' },
                { data: 'state_name' },
                { data: 'district_name' },
                { data: 'block_name' },
                { data: 'pincode' },
                { data: 'fee_type' },
            ]
        });
    }
    $('#ShowAll , #ShowBlock , #Show18 , #Showd1 , #Showd2 ,#ShowdPaid').change(function () {
        localStorage.setItem("ShowAll", $('#ShowAll').is(':checked'));
        localStorage.setItem("ShowBlock", $('#ShowBlock').is(':checked'));
        localStorage.setItem("Show18", $('#Show18').is(':checked'));
        localStorage.setItem("Showd1", $('#Showd1').is(':checked'));
        localStorage.setItem("Showd2", $('#Showd2').is(':checked'));
        localStorage.setItem("ShowdPaid", $('#ShowdPaid').is(':checked'));
               
        var filtercenter = centers;
        BindTable(filtercenter);
    });
    var centers = [];
    function ShowCenters() {

        $.ajax({
            url: "https://cdn-api.co-vin.in/api/v2/appointment/sessions/public/calendarByDistrict?district_id=394&date=" + D,
            headers: {
                Accept: "application/json, text/plain, */*",
                //  "accept-encoding": "gzip, deflate, br"
            },
            success: function (result) {
                console.log(result.centers)
                centers = result.centers;
                BindTable(centers);
            }
        });
    }

   
</script>
</html>
